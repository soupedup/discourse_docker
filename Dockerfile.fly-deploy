FROM registry.fly.io/mr-discourse:latest

ARG DISCOURSE_REDIS_HOST
ENV DISCOURSE_REDIS_HOST=${DISCOURSE_REDIS_HOST}
ARG DISCOURSE_DB_HOST
ENV DISCOURSE_DB_HOST=${DISCOURSE_DB_HOST}
ARG DISCOURSE_DB_NAME
ENV DISCOURSE_DB_NAME=${DISCOURSE_DB_NAME}
ARG DISCOURSE_DB_PASSWORD
ENV DISCOURSE_DB_PASSWORD=${DISCOURSE_DB_PASSWORD}
ARG DISCOURSE_DB_USERNAME
ENV DISCOURSE_DB_USERNAME=${DISCOURSE_DB_USERNAME}

RUN cd /var/www/discourse && bin/rails assets:precompile
